parameters:
  - name: action
    type: object
    values:
      - create
      - validate

  - name: environmentName
    type: string

  - name: regionName
    type: string

  - name: rgName
    type: string

  - name: serviceConnection
    type: string

steps:
  - script: |
      echo action: ${{ parameters.action }}
      echo resourceGroup: $(resourceGroupPrefix)-$(appName)-${{ parameters.environmentName }}-$(regionName)
      echo rgName: ${{ parameters.rgName }}
      echo templateFile: $(System.DefaultWorkingDirectory)/.pipelines/templatesResources/main.bicep
      echo webAppName: $(appName)-${{ parameters.environmentName }}-${{ parameters.regionName }}
      echo webAppNameShort: $(appName)-${{ parameters.environmentName }}
      ls -l .
    displayName: Log paths

  - task: AzureCLI@2
    name:
    displayName: Azure - ${{ parameters.environmentName }} - ${{ parameters.regionName }}
    inputs:
      azureSubscription: ${{ parameters.serviceConnection }}
      scriptType: pscore
      scriptLocation: inlineScript
      inlineScript: |
        $groupExists = az group exists -n ${{ parameters.rgName }}

        if($groupExists -eq 'false') {
          az deployment sub -n $rgName -l "${{ parameters.regionName }}us2"
        }
